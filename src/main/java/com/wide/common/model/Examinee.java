package com.wide.common.model;

import java.util.List;

import com.wide.common.model.base.BaseExaminee;
import com.wide.common.model.query.QueryExam;
import com.wide.common.model.query.QueryExaminee;
import com.wide.util.DateUtil;
import com.wide.viewmodel.DataTablesModel;

/**
 * Generated by JFinal.
 */
@SuppressWarnings("serial")
public class Examinee extends BaseExaminee<Examinee> {
	public static final Examinee dao = new Examinee();

	public DataTablesModel pageDataTables(int pageNum, int pageSize, QueryExaminee queryExaminee, int i) {
		// TODO Auto-generated method stub
		 String select = "select t.id,t.seatno,t.name,t1.cardno,t.fingerprint,t.sculpturepath,t.status";
		    StringBuilder sqlExceptSelect = new StringBuilder(" from sys_examinee t ,sys_user t1");
		    /**
		    if (search!=null&&!search.equals("")) {
		        sqlExceptSelect.append(" AND (b.title like ? or b.content like ? )");
		        parameters.add("%" + search + "%");
		        parameters.add("%" + search + "%");
		    } 
		     **/
		    sqlExceptSelect.append(whereQuery(queryExaminee));
		    sqlExceptSelect.append(orderbyQuery(queryExaminee));
		    
		    return this.paginateDataTables(pageNum, pageSize, select, sqlExceptSelect.toString());
		}
		/**
		 * query where查询
		 * 
		 * */
		private String whereQuery(QueryExaminee queryExaminee){
			String where=" where 1=1  and t.isdel = 0 and t.isenable = 1 and t.user_id = t1.id ";
			if(queryExaminee.getExamId()!=null&&!queryExaminee.getExamId().equals("")){
				where += " and t.exam_id = '"+queryExaminee.getExamId()+"'";
			}
			if(queryExaminee.getExampapers_id()!=null&&!queryExaminee.getExampapers_id().equals("")){
				where += " and t.exampapers_id = '"+queryExaminee.getExampapers_id()+"'";
			}
			if(queryExaminee.getName()!=null&&!queryExaminee.getName().equals("")){
				where += " and t.name like '%"+queryExaminee.getName()+"%'";
			}
			if(queryExaminee.getExamineeId()!=null&&!queryExaminee.getExamineeId().equals("")){
				where += " and t.id ='"+queryExaminee.getExamineeId()+"'";
			}
			return where;
			
		}
		/**
		 * query order by 
		 * 
		 * */
		private String orderbyQuery(QueryExaminee queryExaminee){
			String orderby = " order by t.seatno, t.create_date desc ";
			return orderby;
			
		}
		
		/**
		 * 通过exam_id查询考生列表
		 * @param examId
		 * @return
		 */
		public List<Examinee> getExamineeByExamId(String examId){
			List<Examinee> list = find("select t.* from sys_examinee t where t.isenable = 1 and t.exam_id = ?",examId);
			return list;
		}
	}
